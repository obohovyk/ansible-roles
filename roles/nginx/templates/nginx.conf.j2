# {{ ansible_managed }}

{% if ansible_os_family == 'RedHat' %}
user nginx;
{% elif ansible_os_family == 'Debian' %}
user www-data;
{% endif %}
worker_processes {{ ansible_processor_count }};

pid {{ nginx_pidfile }};

events {
    worker_connections {{ worker_connections }};
}

http {
{% for k,v in nginx_http_params.iteritems() %}
    {{ k }} {{ v }};
{% endfor %}

    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';

    access_log {{ nginx_log_dir }}/{{ nginx_access_log_name }} main;
    error_log {{ nginx_log_dir }}/{{ nginx_error_log_name }} error;

    gzip  on;
    gzip_disable     "msie6";
    gzip_comp_level  4;
    gzip_min_length  1024;
    gzip_types       text/plain text/css text/js text/javascript application/javascript application/json;
    gzip_buffers     16 8k;

{% if ansible_os_family == 'RedHat' %}
    include /etc/nginx/conf.d/*.conf;
{% elif ansible_os_family == 'Debian' %}
    include /etc/nginx/sites-available/*;
{% endif %}
}
